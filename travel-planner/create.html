<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Spot • Travel Planner</title>
  <link rel="stylesheet" href="style.css">
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <script src="firebase.js"></script>
</head>
<body>
  <div class="navbar">
    <div class="brand">Create Spot</div>
    <div class="nav-actions">
      <button onclick="location.href='index.html'">Home</button>
      <button onclick="signOutGo()">Logout</button>
    </div>
  </div>

  <div class="container">
    <h2>Add a new destination</h2>
    <form class="form" id="spotForm">
      <input type="text" id="name" placeholder="Spot Name" required>
      <input type="number" id="cost" placeholder="Cost (₹)" required>
      <input type="number" id="people" placeholder="People Required" required>
      <textarea id="points" placeholder="Points to visit (comma separated)" required></textarea>
      <label>Start Date</label>
      <input type="date" id="startDate" required>
      <label>End Date</label>
      <input type="date" id="endDate" required>
      <input type="text" id="transport" placeholder="Mode of Transport (e.g., Train, Flight, Car)" required>
      <label>Image</label>
      <input type="file" id="imageFile" accept="image/*" required>
      <button class="primary-btn" type="submit">Save Spot</button>
    </form>
  </div>

<script>
let me=null;
requireAuth().then(u=>me=u);

document.getElementById('spotForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  try{
    const file = imageFile.files[0];
    const url = await uploadImageFile(file, `spots/${Date.now()}_${file.name}`);
    const doc = await db.collection('spots').add({
      name: nameEl.value.trim(),
      cost: Number(cost.value),
      people: Number(people.value),
      points: points.value.trim(),
      startDate: startDate.value,
      endDate: endDate.value,
      transport: transport.value.trim(),
      imageURL: url,
      createdBy: me.uid,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    // prepare rollup doc
    await db.collection('spots_interests').doc(doc.id).set({ spotId: doc.id, name: nameEl.value.trim() });
    alert('Spot created!');
    e.target.reset();
  }catch(err){ alert(err.message); }
});

const nameEl = document.getElementById('name');
</script>
</body>
</html>
